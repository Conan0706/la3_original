<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<title>Chat</title>
    <!--CSS-->
    <link rel="stylesheet" href="css/modaal.min.css">
</head>
<body>
    
    <p><a href="/list">戻る</a></p>
    <p><a href="/invite">メンバー追加</a></p>
    <h1><%= @group.name %></h1>
        <h1>ToDo</h1>
        <a href="/task/done" method="get">未達成</a>
        <a href="/task/date" method="get">日付</a>
        
                <% if !@tasks.nil? %>
                <table>
                    <% @members.each do |member| %>
                        <% if member.group_id == @group.id %>
                            <% user = User.find_by(id: member.user_id) %>
                            <% @tasks.each do |task| %>
                                <div class="todo">
                                    <% if task.user_id == user.id %>
                                        
                                            <tr>
                                                <td class="name"><p><%= user.name %></p></td>
                                                <td class="todo"><p><%= task.todo %></p></td>
                                                <td class><p><%= task.due_date %></p></td>
                                                <td>
                                                    <form action="/task/<%= task.id %>/done" method="post">
                                                        <p><input type="submit" value="<%= task.done %>"></p>
                                                    </form>
                                                </td>
                                                <td>
                                                    <a href="#inline" class="inline">編集</a>
                                                </td>
                                                <td>
                                                    <div id="inline" style="display:none;">
                                                        <form action="/task/<%= task.id %>/edit" method="post">
                                                            <input type="text" name="todo" value="<%= task.todo %>">
                                                            <input type="date" name="due_date" value="<%= task.due_date %>">
                                                            <p><input type="submit" value="変更を確定"></p>
                                                        </form>
                                                    </div>
                                                </td>
                                                <td>
                                                    <form action="/task/<%= task.id %>/delete" method="post">
                                                        <p><input type="submit" value="削除"></p>
                                                    </form>
                                                </td>
                                            </tr>
                                        
                                    <% end %>
                                </div>
                            <% end %>
                        <% end %>
                    <% end %>
                </table>
                <% else %>
                    <p>タスクがありません</p>
                <% end %>
                <div class="register">
                    <form action="/task" method="post">
                        <input type="text" name="todo" placeholder="タスク内容">
                        <input type="date" name="due_date" placeholder="締め切り">
                        <input type="hidden" name="user_id" value="<%= current_user.id %>">
                        <input type="hidden" name="done" value="false">
                        <input type="submit" value="作成！">
                    </form>
                </div>

                <div>
                    <h1><%= @group_name %></h1>
                    <% @members.each do |member| %>
                        <% if member.group_id == @group %>
                            <% user = member.user_id %>
                            <% group_user = User.find_by(id: user) %>
                            <% if !group_user.nil? %>
                                <img src="<%= chat.image %>" width="125" height="125">
                            <% end %>
                            <%= group_user.name %>
                        <% end %>
                    <% end %>
                </div>
                <div>
                    <% if !@chats.nil? %>
                       <% @chats.each do |chat| %>
                           
                                <% if chat.group_id == @group.id %>
                                    <% user = User.find_by(id: chat.user_id) %>
                                    <div class="<% if (user.id == @current_user.id) %>me<% else %>patner<% end %>">
                                        <% if !user.image.empty? %>
                                            <div class="icon">
                                                <img src="<%= user.image %>">
                                            </div>
                                        <% end %>
                                        <!--<p><b><%= user.name %></b></p>-->
                                        <div class="sb-side">
                                           <div class="sb-text">
                                                <p><%= chat.comment %></p>
                                                <% if !chat.image.nil? %>
                                                    <a href="<%= chat.image %>" class="image" data-modaal-desc="ディスクリプション"><img src="<%= chat.image %>" width="125" height="125"></a>
                                                <% end %>
                                            </div>
                                        </div>
                                    </div>
                            <% end %>
                        <% end %>
                    <% else %>
                        <p>まだ会話なし</p>
                    <% end %>
                </div>
    <div class="form">
        <form action="/chat" method="post" enctype="multipart/form-data">
            <input type="text" name="comment">
            <input type="hidden" name="user_id" value="<%= @current_user.id %>">
            <input type="hidden" name="group_id" value="<%= @group.id %>">
            <input type = "file" name="image" placeholder="写真"> 
            <input type="submit" value="送信">
        </form>
    </div>
        <!--JS-->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="js/modaal.min.js" type="text/javascript"></script>
</body>